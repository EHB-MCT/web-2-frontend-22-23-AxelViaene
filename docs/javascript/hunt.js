window.onload=e=>{const t=sessionStorage.getItem("user"),n=JSON.parse(t);let o="",s=[],l="";var r=[17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,34,35,36,37,38,39,40,41,42,43,44,45,48,49,50,53];let a="",c=0;const d=document.querySelectorAll(".rankIcon");var i=-1;const m={"Ancient Forest":1,"Wildspire Waste":3,"Coral Highlands":5,"Rotten Vale":7,"Elder's Recess":8};try{if(!t)return void(window.location.href="../html/login.html");n?(document.getElementById("authname").innerText=`Welcome ${n.name}`,console.log(`Welcomeeee ${n.name}`)):window.location.href="../html/login.html"}catch(e){console.error("error",e)}var g=document.getElementById("regionDropdown"),h=document.getElementById("regionButton"),u=(document.getElementsByClassName("regionOption"),document.getElementById("overlay")),p=document.getElementById("huntButton"),y=document.getElementById("huntOverlay"),f=document.getElementById("carousel"),w=0,I=[],v=document.getElementById("previousWeapon"),E=document.getElementById("nextWeapon"),b=document.getElementById("carouselNumber");document.addEventListener("click",(function(e){e.target===h&&(g.style.display="block"),e.target.classList.contains("regionOption")&&(l=e.target.textContent,h.textContent=l,g.style.display="none",i=m[l],d.forEach(((e,t)=>{e.src=t<i?"../icons/star-full.png":"../icons/star-empty.png"})))})),document.addEventListener("click",(function(e){e.target!==h&&(g.style.display="none")})),document.addEventListener("click",(function(e){if(e.target===p){u.style.display="block";const e=s[w],t=e.id;console.log("------------------"),async function(){try{var e=[];const t=r.map((async function(t){const n=await fetch(`https://mhw-db.com/monsters/${t}`),o=await n.json();e.push(o)}));await Promise.all(t);const n=e.filter((e=>e.locations.some((e=>e.name===l))));if(n.length>0){const e=Math.floor(Math.random()*n.length);a=n[e],console.log("Random Monster:",a.name)}else console.log("No monster found in selected region.")}catch(e){console.error("Error fetching monster data:",e)}}().then((()=>{console.log(e);const n=e.rarity-i;if(1===e.elements.length){const t=e.elements[0].type;a.resistances.some((e=>e.element===t))?(console.log("resistant"),c=-20):(console.log("not resistant"),a.weaknesses.some((e=>3===e.stars&&e.element===t))?(c=20,console.log("is weak")):console.log("not weak, so neutral"))}const s=75+10*Math.random()+20*n+c;if(console.log("random:",s),s>100*Math.random()){console.log("succes"),fetch("https://web2-course-project.onrender.com/hunts").then((e=>e.json())).then((t=>{let n=null;for(let e=1;e<=t.length+1;e++)if(!t.some((t=>t.HuntId===e))){n=e;break}let o={};o.UserId=k,o.GreatswordId=e.id,o.MonsterId=a.id,o.location=l,o.HuntId=n}));const t=e.crafting;if(t.branches&&t.branches.length>0){const e=Math.floor(Math.random()*t.branches.length),n=t.branches[e];console.log("Random Branch:",n);let s=null;for(let e=1;e<=o.length+1;e++)if(!o.some((t=>t.UserGreatswordId===e))){s=e;break}let l={};l.UserId=k,l.GreatswordId=n,l.UserGreatswordId=s,console.log(l),async function(e,t,n){let o=await fetch("https://web2-course-project.onrender.com/save_user_greatsword",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});return await o.json()}(0,0,l).then((e=>{console.log(e)}))}else console.log("No branches available.")}else{console.log("fail");const n=e.crafting;if(n.previous){const e=n.previous;console.log("Previous weapon ID:",e);let s=null;for(let e=1;e<=o.length+1;e++)if(!o.some((t=>t.UserGreatswordId===e))){s=e;break}let l={};l.UserId=k,l.GreatswordId=e,l.UserGreatswordId=s,console.log(l),async function(e,t,n){let o=await fetch("https://web2-course-project.onrender.com/save_user_greatsword",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});await o.json()}(0,0,l),fetch(`https://web2-course-project.onrender.com/delete_UGS_by_id?UserId=${k}&GreatswordId=${t}`,{method:"DELETE"})}}}))}})),document.addEventListener("click",(function(e){e.target!=u||y.contains(e.target)||(u.style.display="none")})),v.addEventListener("click",(function(){--w<0&&(w=I.length-1),B(w)})),E.addEventListener("click",(function(){++w>=I.length&&(w=0),B(w)}));const k=n.UserId;function B(e){I.forEach(((t,n)=>{t.style.display=n===e?"block":"none"})),b.textContent=e+1+"/"+I.length}fetch("https://web2-course-project.onrender.com/user_greatswords").then((e=>e.json())).then((e=>{o=e.filter((function(e){return e.UserId===k})),o.sort(((e,t)=>e.GreatswordId-t.GreatswordId)),console.log(o),Object.keys(o).length,Promise.all(o.slice(0,88).map((e=>{const t=e.GreatswordId;return fetch(`https://mhw-db.com/weapons/${t}`).then((e=>e.json()))}))).then((e=>{s=e,e.forEach(((e,t)=>{const n=Object.keys(e.elements).length;let o=`<div class="slide${t+1}">\n                            <div class="greatsword gs1">\n                                <div class="gsInternal">\n                                    <div class="gsTop">\n                                        <p class="gsName">${e.name}<p>\n                                    </div>\n                                    <img class="gsIcon" src="../icons/greatswords/Greatsword${e.rarity}.png" alt="">\n                                    <div class="gsStatsLeft">\n                                        <p>Rarity:${e.rarity}</p>\n                                        <p>Element:</p>\n                                    </div>\n                                    <div class="gsStatsRight">\n                                        <p class="gsAttack">Attack: ${e.attack.display}</p>\n                                        <div class="element">\n                                            <p class="gsElementDamage"></p>`;o+=1===n?`<p class="gsElementDamage">${e.elements[0].damage}</p>\n                                                        <img class="gsElement" src="../icons/elements/${e.elements[0].type}.png" alt="">`:'<p class="gsElementDamage">0</p>',o+="</div>\n                                                    </div>\n                                                </div>";const s=document.createElement("div");s.classList.add("slide"),s.classList.add(`slide${t+1}`),s.innerHTML=o,f.appendChild(s)})),(I=document.querySelectorAll(".slide"))[w].style.display="block",B(w)}))})),document.getElementById("logoutButton").addEventListener("click",(function(){sessionStorage.removeItem("user"),window.location.assign("../html/login.html")}))};
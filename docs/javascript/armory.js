window.onload=e=>{const t=sessionStorage.getItem("user"),n=JSON.parse(t),s=document.getElementById("main");try{if(!t)return void(window.location.href="../html/login.html");n?(document.getElementById("authname").innerText=`Welcome ${n.name}`,console.log(`Welcome ${n.name}`)):window.location.href="../html/login.html"}catch(e){console.error("error",e)}const o=n.UserId;fetch("https://web2-course-project.onrender.com/user_greatswords").then((e=>e.json())).then((e=>{var t=e.filter((function(e){return e.UserId===o}));t.sort(((e,t)=>e.GreatswordId-t.GreatswordId));const n=Object.keys(t).length;Promise.all(t.slice(0,88).map((e=>{const t=e.GreatswordId;return fetch(`https://mhw-db.com/weapons/${t}`).then((e=>e.json()))}))).then((e=>{if(e.forEach(((e,n)=>{const o=Object.keys(e.elements).length,a=t[n].UserGreatswordId;let l=`<div class="gsInternal">\n                                    <div class="gsTop">\n                                        <button class="close-button btn${r}">\n                                            <span class="close-icon">&times;</span>\n                                        </button>\n                                        <p class="gsName">${e.name}\n                                        <p>\n                                    </div>\n                                    <img class="gsIcon" src="../icons/greatswords/Greatsword${e.rarity}.png" alt="">\n                                    <div class="gsStatsLeft">\n                                        <p>Rarity:${e.rarity}</p>\n                                        <p>Element:</p>\n                                    </div>\n                                    <div class="gsStatsRight">\n                                        <p class="gsAttack">Attack: ${e.attack.display}</p>\n                                        <div class="element">\n                                            <p class="gsElementDamage"></p>`;l+=1===o?`<p class="gsElementDamage">${e.elements[0].damage}</p>\n                                    <img class="gsElement" src="../icons/elements/water.png" alt="">`:'<p class="gsElementDamage">0</p>',l+="</div>\n                                            </div>\n                                        </div>";var c=document.createElement("div");c.className=`greatsword gs${r}`,c.id=`${a}`,c.innerHTML=l,s.appendChild(c),c.getElementsByClassName(`btn${r}`)[0].addEventListener("click",(function(){confirm("Are you sure you want to remove this weapon from your collection?")?(console.log(`Removed weapon with UserGreatswordId ${a}`),fetch(`https://web2-course-project.onrender.com/delete_user_greatsword?usergreatswordid=${a}`,{method:"DELETE"}),setTimeout((function(){location.reload()}),2e3)):console.log("NO DELETE ONLY CLICK")})),r++})),n<10){let e='\n                                <div class="gsInternal">\n                                    <div class="gsTop">\n                                        <p class="gsName">New weapon</p>\n                                    </div>\n                                    <p id="newGS" class="newSword">Click here for a new weapon</p>                                \n                                </div>';var a=document.createElement("div");a.className=`greatsword gs${n+1}`,a.innerHTML=e,s.appendChild(a)}document.getElementById("newGS").addEventListener("click",(function(){fetch("https://mhw-db.com/weapons/1").then((e=>e.json())).then((e=>{fetch("https://web2-course-project.onrender.com/user_greatswords").then((e=>e.json())).then((e=>{let t=null;for(let n=1;n<=e.length+1;n++)if(!e.some((e=>e.UserGreatswordId===n))){t=n;break}console.log("Available ID:",t),console.log(e);let n={};n.UserId=o,n.GreatswordId=1,n.UserGreatswordId=t,async function(e,t,n){let s=await fetch("https://web2-course-project.onrender.com/save_user_greatsword",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});return await s.json()}(0,0,n).then((e=>{console.log(e)})),setTimeout((function(){location.reload()}),2e3)}))}))}))}));var r=1})),document.getElementById("logoutButton").addEventListener("click",(function(){sessionStorage.removeItem("user"),window.location.assign("../html/login.html")}))};
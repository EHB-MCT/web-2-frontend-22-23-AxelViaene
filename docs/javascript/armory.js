window.onload=e=>{const n=sessionStorage.getItem("user"),t=JSON.parse(n),o=document.getElementById("main");try{if(!n)return void(window.location.href="../html/login.html");t?(document.getElementById("authname").innerText=`Welcome ${t.name}`,console.log(`Welcome ${t.name}`)):window.location.href="../html/login.html"}catch(e){console.error("error",e)}const s=t.UserId;fetch("https://web2-course-project.onrender.com/user_greatswords").then((e=>e.json())).then((e=>{var n=e.filter((function(e){return e.UserId===s}));n.sort(((e,n)=>e.GreatswordId-n.GreatswordId));const t=Object.keys(n).length;Promise.all(n.slice(0,88).map((e=>{const n=e.GreatswordId;return fetch(`https://mhw-db.com/weapons/${n}`).then((e=>e.json()))}))).then((e=>{if(e.forEach(((e,t)=>{const s=Object.keys(e.elements).length,a=n[t].UserGreatswordId;console.log(e);let c=`<div class="gsInternal">\n                                    <div class="gsTop">\n                                        <button class="close-button btn${r}">\n                                            <span class="close-icon">&times;</span>\n                                        </button>\n                                        <p class="gsName">${e.name}\n                                        <p>\n                                    </div>\n                                    <img class="gsIcon" src="../icons/greatswords/Greatsword${e.rarity}.png" alt="">\n                                    <div class="gsStatsLeft">\n                                        <p>Rarity:</p>\n                                        <p>Element:</p>\n                                    </div>\n                                    <div class="gsStatsRight">\n                        \n                                       <p class="gsAttack">${e.rarity}</p>\n                                          `;c+=1===s?`\n                                    <img class="gsElement" src="../icons/elements/${e.elements[0].type}.png" alt="">`:'<p class="noElement">None</p>',c+="\n                        \n                                            </div>\n                                        </div>";var l=document.createElement("div");l.className=`greatsword gs${r}`,l.id=`${a}`,l.innerHTML=c,o.appendChild(l),l.getElementsByClassName(`btn${r}`)[0].addEventListener("click",(function(){confirm("Are you sure you want to remove this weapon from your collection?")?(console.log(`Removed weapon with UserGreatswordId ${a}`),fetch(`https://web2-course-project.onrender.com/delete_user_greatsword?usergreatswordid=${a}`,{method:"DELETE"}),setTimeout((function(){location.reload()}),2e3)):console.log("NO DELETE ONLY CLICK")})),r++})),t<10){let e='\n                                <div class="gsInternal">\n                                    <div class="gsTop">\n                                        <p class="gsName">New weapon</p>\n                                    </div>\n                                    <p id="newGS" class="newSword">Click here for a new weapon</p>                                \n                                </div>';var a=document.createElement("div");a.className=`greatsword gs${t+1}`,a.innerHTML=e,o.appendChild(a)}document.getElementById("newGS").addEventListener("click",(function(){fetch("https://mhw-db.com/weapons/1").then((e=>e.json())).then((e=>{fetch("https://web2-course-project.onrender.com/user_greatswords").then((e=>e.json())).then((e=>{let n=null;for(let t=1;t<=e.length+1;t++)if(!e.some((e=>e.UserGreatswordId===t))){n=t;break}console.log("Available ID:",n),console.log(e);let t={};t.UserId=s,t.GreatswordId=1,t.UserGreatswordId=n,async function(e,n,t){let o=await fetch("https://web2-course-project.onrender.com/save_user_greatsword",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return await o.json()}(0,0,t).then((e=>{console.log(e)})),setTimeout((function(){location.reload()}),2e3)}))}))}))}));var r=1})),document.getElementById("logoutButton").addEventListener("click",(function(){sessionStorage.removeItem("user"),window.location.assign("../html/login.html")}))};